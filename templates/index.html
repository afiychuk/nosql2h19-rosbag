<!doctype html>
<link rel="stylesheet" href="https://cdn.webix.com/edge/webix.css" type="text/css"> 
<script src="https://cdn.webix.com/edge/webix.js" type="text/javascript"></script>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="static/script.js"></script>

<title>Hello from Flask</title>

<!-- {% if name %}
  <h1>Hello {{ name }}!</h1>
{% else %}
  <h1>Добавьте данные в бд</h1>
{% endif %} -->
  <!-- <div id="tmpButton"
       style="border-style: dashed; padding: 5px 10px 5px 10px; margin: auto; width: fit-content;"
       onclick="addData()"><h3>Добавить данные в БД</h3></div> -->
<script type="text/javascript" charset="utf-8">
  webix.ready(function(){
    grida = webix.ui({
	    "rows": [{
            "view": "toolbar", "css": "webix_dark", "padding": { "right": 10, "left": 10 },
			"elements": [ { "view": "label", "label": "ROS Bags DB" } ]
		},
		{
			"type": "wide",
			"cols": [
				{ "view": "menu", "width": 163, layout: "y", subMenuPos: "right", data: [
					{ id:"1", value:"Добавить..."},
					{ id:"2", value:"Фильтр...", submenu: [ 
                        { id: "1_1", value: "Дата"},
                        { id: "1_2", value: "Теги"},
                        { id: "1_3", value: "Размер"},
                        { id: "1_4", value: "Дата"},
                    ]},
                    { id: "3", value:"Info...", submenu:[ "About", "Help" ] }
                ],
            on: {
                onMenuItemClick: function(id){
                    console.log(id)
                    webix.ajax("/getDocumentsNumber", function(text){
                        console.log(text)
                        console.log($$("mainTable").parse([{id: "", filename: "Name1"}, {id: "2", filename: "bar2"},]))
                        // var obj = webix.DataDriver.json.toObject(text);
                    })
                },
            }
        },
		{
            "view": "datatable",
            "columns": [
                { id: "filename", "header": "Название", "fillspace": true, "sort": "string", "hidden": false },
                { id: "creation", "header": "Дата создания", "sort": "string", "fillspace": true, "hidden": false },
                { id: "topics_list", "header": "Топики", "sort": "string", "fillspace": true, "hidden": false },
                { id: "duration", "header": "Продолжительность", "sort": "string", "fillspace": true, "hidden": false }
            ],
            "id": "mainTable",
            "select": true,
            "scrollX": false,
            "fixedRowHeight": false,
            "multiselect": false,
            "footer": false,
            "checkboxRefresh": false,
            "width": null,
            on: {
                onBeforeLoad:function(){
                    this.showOverlay("Loading...");
                },
                onAfterLoad:function(){
                    this.hideOverlay();
                }
            },

            url: function(){
					return webix.promise(function(res){
						setTimeout(function(){
							res(webix.ajax("/getFaceData", function(result){
                                result = JSON.parse(result)
                                let i = 0
                                for (var key in result) {
                                    // check if the property/key is defined in the object itself, not in parent
                                    name = result[key]["filename"]
                                    console.log($$("mainTable").parse([{id: i, filename: name}]))
                                    i++
                                }
                                
                            }));
						}, 1000)
					});
				}
        }
    ]
}
]
}
);
      })
</script>